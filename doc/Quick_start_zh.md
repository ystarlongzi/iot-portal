# å¿«é€Ÿå¼€å§‹

æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°é…ç½®è¿è¡Œ SaaS å¼€å‘æ¡†æ¶çš„å‰ç«¯é¡¹ç›®ï¼ŒåŸºäºæ­¤æ‚¨å¯ä»¥è¿›è¡ŒäºŒæ¬¡å¼€å‘è‡ªå·±ä¸šåŠ¡ã€‚

æœ¬æ–‡åˆ†ä¸º`å®‰è£…è¿è¡Œ`å’Œ`è°ƒè¯•`ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«ä»‹ç»å¦‚ä½•å®‰è£…å’Œå¯åŠ¨é¡¹ç›®ä»¥åŠå¦‚ä½•æœ¬åœ°äºŒæ¬¡å¼€å‘ã€‚


## ç¯å¢ƒä¾èµ–
- [Node.js â‰¥ 12.0.0](https://nodejs.org/en/) ï¼ˆå»ºè®®å®‰è£… LTS ç‰ˆæœ¬ï¼‰
- [Yarn](https://yarnpkg.com/) ï¼ˆå¯é€‰ï¼‰
- [Git](https://git-scm.com/)
- [Docker](https://www.docker.com) ï¼ˆå¯é€‰ï¼Œç”¨äºæ„å»ºé•œåƒï¼‰

## å®‰è£…è¿è¡Œ
### æ­¥éª¤ 1ï¼šå¯åŠ¨æ¥å£æœåŠ¡

SaaS å¼€å‘æ¡†æ¶çš„å‰ç«¯é¡¹ç›®éœ€è¦æœåŠ¡ç«¯æä¾›æ¥å£æœåŠ¡ï¼Œæˆ‘ä»¬æä¾›ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¯åŠ¨æ¥å£æœåŠ¡ï¼š

  1. [æœ¬åœ°è¿è¡Œ SaaS å¼€å‘æ¡†æ¶åç«¯é¡¹ç›®](https://developer.tuya.com/cn/docs/iot/SaaSDevelopmentFramework_backend?id=Kaqcx9hwc9i62)

  2. [è¿è¡Œ SaaS å¼€å‘æ¡†æ¶ Docker é•œåƒ](https://developer.tuya.com/cn/docs/iot/SaaSDevelopmentFramework_Image?id=Kapsg7pttb8f2) 
 
**ğŸ’¬ è¯´æ˜ï¼š**

  - å¦‚æœä»…ä»…æ˜¯æƒ³ä½“éªŒæœ¬é¡¹ç›®çš„å¼€å‘ã€è°ƒè¯•æµç¨‹ï¼Œå»ºè®®ä½¿ç”¨ã€Œæ–¹æ³• 2ã€å¯åŠ¨æ¥å£æœåŠ¡

  - é»˜è®¤æ¥å£æœåŠ¡åœ°å€ä¸º `http://localhost`ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ [./bin/server.js#L13](./bin/server.js#L13) é…ç½®

### æ­¥éª¤ 2ï¼šå®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone git@github.com:tuya/iot-portal.git

# è·³è½¬åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•
cd ./iot-portal

# ä½¿ç”¨ yarn å®‰è£…ä¾èµ–
yarn

# æˆ–è€…ä½¿ç”¨ npm å®‰è£…ä¾èµ–
npm install
```

### æ­¥éª¤ 3ï¼šç¼–è¯‘å‰ç«¯é¡¹ç›®

```bash
# ä½¿ç”¨ yarn ç¼–è¯‘
yarn run build

# æˆ–è€…ä½¿ç”¨ npm ç¼–è¯‘
npm run build
```

ç¼–è¯‘åçš„æ–‡ä»¶å¦‚ä¸‹ï¼š
> <img width="300" src="./images/build.png" />

### æ­¥éª¤ 4ï¼šå¯åŠ¨ http æœåŠ¡

```bash
# ä½¿ç”¨ yarn å¯åŠ¨æœåŠ¡
yarn run start

# æˆ–è€…ä½¿ç”¨ npm å¯åŠ¨æœåŠ¡
npm run start
```

è‡³æ­¤ï¼Œå°±å®Œæˆäº†é¡¹ç›®çš„å¯åŠ¨ï¼ŒæœåŠ¡é»˜è®¤ç›‘å¬ `8888` ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ [http://localhost:8888](http://localhost:8888) å°±èƒ½æ­£å¸¸è®¿é—®ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•è°ƒè¯•å’Œå¼€å‘å­åº”ç”¨ã€‚


## è°ƒè¯•æœåŠ¡

SaaS å¼€å‘æ¡†æ¶é‡‡ç”¨çš„æ˜¯å¾®å‰ç«¯çš„æ¶æ„ï¼Œæ¯ä¸ªå¾®å‰ç«¯åº”ç”¨å‡ä¸ºç‹¬ç«‹é¡¹ç›®ï¼Œéœ€è¦é…ç½®ç‹¬ç«‹çš„ä¾èµ–ï¼Œä¸”æ¯ä¸ªå¾®å‰ç«¯åº”ç”¨å‡å¯ç‹¬ç«‹éƒ¨ç½²ç‹¬ç«‹è¿è¡Œã€‚æœ¬æ–‡ä»¥è°ƒè¯• [`./applications/asset-app`](./applications/asset-app)ï¼ˆè´¦æˆ·ç®¡ç†å­åº”ç”¨ï¼‰ ä¸ºä¾‹ä¸ºæ‚¨ä»‹ç»è°ƒè¯•æµç¨‹ã€‚

### æ­¥éª¤ 1ï¼šå¯åŠ¨æ¥å£æœåŠ¡

ä¸ºäº†é™ä½è°ƒè¯•éš¾åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ [è¿è¡Œ SaaS å¼€å‘æ¡†æ¶ Docker é•œåƒ](https://developer.tuya.com/cn/docs/iot/SaaSDevelopmentFramework_Image?id=Kapsg7pttb8f2) å¯åŠ¨æ¥å£æœåŠ¡ã€‚

åœ¨æ¥å£æœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œç¡®ä¿ [`./setupProxy.js#L5`](./setupProxy.js#L5) é…ç½®äº†æ­£ç¡®çš„æœåŠ¡åœ°å€


### æ­¥éª¤ 2ï¼šå¯åŠ¨å­åº”ç”¨

```bash
# è¿›å…¥éœ€è¦è°ƒè¯•çš„å­åº”ç”¨
cd ./applications/asset-app

# å¯åŠ¨å­åº”ç”¨
yarn run start

# æˆ–è€…ä½¿ç”¨ npm å¯åŠ¨å­åº”ç”¨
npm run start
```

> æœåŠ¡å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ [http://localhost:7001/asset-app/](http://localhost:7001/asset-app/) å°±èƒ½è®¿é—®è¯¥å­åº”ç”¨ã€‚
> 
> å› ä¸ºæˆ‘ä»¬ä½¿ç”¨å­ç›®å½•çš„å½¢å¼éƒ¨ç½²å­åº”ç”¨ï¼Œæ‰€ä»¥ url åœ°å€é‡Œä¼šæœ‰ `/asset-app` è·¯å¾„å­˜åœ¨ã€‚
> 
> å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ `./applications/asset-app/.env` ä¸­ä¿®æ”¹ `7001` ç«¯å£ã€‚

#### åœºæ™¯ 1ï¼šåœ¨æ¥å£æœåŠ¡è¿˜æœªå¯åŠ¨æ—¶

å®Œæˆç¼–è¯‘æµç¨‹åï¼Œæˆ‘å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å¦‚ä¸‹ç•Œé¢

> <img width="550" src="./images/asset-app-empty.png" />

#### åœºæ™¯ 2ï¼šåœ¨æ¥å£æœåŠ¡å¯åŠ¨æ­£å¸¸æ—¶

åœ¨å®Œæˆç¼–è¯‘æµç¨‹åï¼Œä¼šè‡ªåŠ¨è·³åˆ° `http://localhost:7001/login` ï¼Œè¿™æ˜¯å› ä¸ºæ¥å£è¯·æ±‚ä¸åŒ…å«ç™»å½•ä¿¡æ¯ï¼Œåç«¯æœåŠ¡æ”¶åˆ°è¯·æ±‚åä¼šæŠ›å¼‚å¸¸å‡ºæ¥ï¼Œå‰ç«¯æœåŠ¡åœ¨æ”¶åˆ°å¼‚å¸¸åï¼Œå‘ç°æ˜¯ç™»å½•æ€å¤±æ•ˆï¼Œå°±ä¼šè·³è½¬åˆ° `/login`ï¼Œéœ€è¦ç”¨æˆ·é‡æ–°ç™»é™†

> <img width="550" src="./images/asset-app-error.png" />

ä½†æˆ‘ä»¬çš„å­åº”ç”¨ä¸æä¾›ç™»é™†åŠŸèƒ½ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å†å°†è§†è§’è½¬å›åˆ°ä¸»åº”ç”¨


### æ­¥éª¤ 3ï¼šå¯åŠ¨ä¸»åº”ç”¨

æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£å¯åŠ¨ä¸»åº”ç”¨ï¼Œè¯¥è¿‡ç¨‹ä¸å¯åŠ¨å­åº”ç”¨ç±»ä¼¼

```bash
# è¿›å…¥ä¸»åº”ç”¨
cd ./applications/main-app

# å¯åŠ¨ä¸»åº”ç”¨
yarn run start

# æˆ–è€…ä½¿ç”¨ npm å¯åŠ¨ä¸»åº”ç”¨
npm run start
```

å¯åŠ¨å®Œæˆï¼Œé»˜è®¤ä¼šæ¥åˆ°ç™»é™†é¡µé¢ [http://localhost:3000/login](http://localhost:3000/login) ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚DockeræœåŠ¡é»˜è®¤åˆå§‹åŒ–çš„è´¦æˆ·æ˜¯ï¼š

 - è´¦å·ï¼šadmin@tuya.com
 - å¯†ç ï¼šAdmin123456

> <img width="550" src="./images/main-app-login.png" />


ç™»é™†æˆåŠŸåå°±å¯ä»¥è¿›å…¥åˆ° `asset-app`

> <img width="550" src="./images/asset-app.png" />

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ã€Œä¸»åº”ç”¨ + å­åº”ç”¨ã€çš„åµŒå¥—è°ƒè¯•æœåŠ¡çš„å¯åŠ¨


## å¾®å‰ç«¯é…ç½®è¯´æ˜

SaaSå¼€å‘æ¡†æ¶æ˜¯åŸºç¡€ [qiankun](https://qiankun.umijs.org/zh) å®ç°ï¼Œå¾®å‰ç«¯çš„åŸºåº§åº”ç”¨æ˜¯ `main-app`ï¼Œæ‰€æœ‰çš„å­åº”ç”¨å…¨éƒ¨ä¾èµ–åŸºåº§åº”ç”¨æ¥åŠ è½½ï¼Œå…·ä½“çš„é…ç½®ä½ç½® [`./applications/main-app/src/qiankun`](./applications/main-app/src/qiankun)

