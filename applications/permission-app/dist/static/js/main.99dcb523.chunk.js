!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["iot-suite-permission-main"]=t():e["iot-suite-permission-main"]=t()}(window,(function(){return(window["webpackJsonp_iot-suite-permission"]=window["webpackJsonp_iot-suite-permission"]||[]).push([[0],{118:function(e,t,n){e.exports={roleListWrap:"roleListWrap_2vC0H",roleListTop:"roleListTop_3CaUG",roleListTitle:"roleListTitle_3txgh"}},158:function(e,t,n){e.exports={background:"background_3Hklw",tableContainerWrap:"tableContainerWrap_T4003",tableCtrlWrap:"tableCtrlWrap_2TPMF",ctrlLabel:"ctrlLabel_RH0HN",textBlue:"textBlue_311GG",textGray:"textGray_3QRcj",pointer:"pointer_2Atg7",tableCell:"tableCell_3Uj4l"}},165:function(e,t,n){"use strict";(function(e){var o=n(75),r=n(29),a=n(126),c=n(166),i=n.n(c);"undefined"!==typeof e&&Object.assign(e,{_JSXStyle:i.a});t.a=function(){var e=["removeRole"],t=Object(o.d)(),n=t.language;"zh-CN"===n?t.changeLanguage(n):t.changeLanguage("en-US"),r.configMethod.initGlobalConfig({headers:{"Accept-Language":"zh-CN"===n?n:"en-US"},baseURL:"/api",onError:function(t){var n=t.code,o=t.msg,r=t.apiMethodName;if("1010"===n||"111"===n)return localStorage.removeItem("_USERNAME"),localStorage.removeItem("_UID"),localStorage.removeItem("_ROLE_TYPE"),void window.location.replace("/login");e.includes(r)||a.b.error(o)}})}}).call(this,n(77))},183:function(e,t,n){window.__POWERED_BY_QIANKUN__&&(n.p=window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__)},187:function(e,t,n){},188:function(e,t,n){},309:function(e,t,n){"use strict";n.r(t),n.d(t,"setGlobalState",(function(){return ie})),n.d(t,"micState",(function(){return le})),n.d(t,"mainHistory",(function(){return se})),n.d(t,"bootstrap",(function(){return be})),n.d(t,"mount",(function(){return fe})),n.d(t,"unmount",(function(){return pe}));var o=n(43),r=n(63),a=n.n(r),c=n(117),i=n(0),l=(n(183),n(24)),s=n.n(l),u=n(173),d=n(75),b=(n(187),n(179)),j=n(155),f={translation:{removeModal:{title:"Confirm",content:"Are you sure to delete this role? The action cannot be undone.",okText:"Delete",confirmBtn:"Ok",confirmContent:"Before you delete the role, make sure that there is no account under the role."},roleList:{title:"Role","manager-1000":"Admin","normal-1000":"User"},addRole:{title:"Create Role",roleName:"Role Name",selectRole:"Select Role Template",admin:"Admin",user:"User",require:"Require"},editRole:{require:"Role name can not be empty."},permissionTable:{save:"save",reset:"reset",success:"Successfully saved"}}},m={translation:{removeModal:{title:"\u64cd\u4f5c\u786e\u8ba4",content:"\u89d2\u8272\u5220\u9664\u4e4b\u540e\u4e0d\u53ef\u6062\u590d, \u786e\u5b9a\u8981\u5220\u9664\u89d2\u8272\u5417?",okText:"\u786e\u8ba4\u5220\u9664",confirmBtn:"\u77e5\u9053\u4e86",confirmContent:"\u8bf7\u786e\u4fdd\u8be5\u89d2\u8272\u4e0b\u65e0\u8d26\u53f7, \u624d\u80fd\u5220\u9664\u5f53\u524d\u89d2\u8272\u3002"},roleList:{title:"\u89d2\u8272","manager-1000":"\u7ba1\u7406\u5458","normal-1000":"\u666e\u901a\u7528\u6237"},addRole:{title:"\u65b0\u5efa\u89d2\u8272",roleName:"\u89d2\u8272\u540d\u79f0",selectRole:"\u9009\u62e9\u89d2\u8272",admin:"\u7ba1\u7406\u5458",user:"\u666e\u901a\u7528\u6237",require:"\u5fc5\u586b\u9879"},editRole:{require:"\u89d2\u8272\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a"},permissionTable:{save:"\u4fdd\u5b58",reset:"\u91cd\u7f6e",success:"\u4fdd\u5b58\u6210\u529f"}}};b.a.use(j.a).use(d.e).init({resources:{"en-US":f,"zh-CN":m},fallbackLng:"zh-CN",interpolation:{escapeValue:!1}});var p=n(17),h=n(168),O=n.n(h),v=n(167),x=n.n(v),C=(n(188),n(18)),g=n(319),S=n(158),y=n.n(S),_=n(29),N=n(311),k=n(312),R=n(316),w=n(126),T=n(320),L=n(322),E=n(323),I="manager-1000",W="normal-1000",U=n(6),B=function(e){var t=e.roleName,n=e.roleCode,o=e.onFinish,r=e.onRemove,a=Object(i.useRef)(null),c=Object(g.a)().t,l=Object(i.useState)(!1),s=Object(C.a)(l,2),u=s[0],d=s[1],b=Object(i.useState)(t),j=Object(C.a)(b,2),f=j[0],m=j[1];return Object(i.useEffect)((function(){u&&a.current.focus()}),[u]),Object(U.jsxs)(U.Fragment,{children:[u?Object(U.jsx)(R.a,{ref:a,maxLength:20,value:f,onChange:function(e){var t=e.target.value;m(t)},onBlur:function(e){d(!1);var t=e.target.value;if(0===t.length)return w.b.error(c("editRole.require")),void o(!1);_.apiService.editRoleName({roleCode:n,roleName:t}).then((function(){o(!0)}))}}):Object(U.jsxs)(N.a,{className:"roleItem",justify:"space-between",children:[Object(U.jsx)(k.a,{children:t}),n===I||n===W?null:Object(U.jsx)(k.a,{className:"roleItemCtrl",children:Object(U.jsxs)(T.b,{children:[Object(U.jsx)(L.a,{onClick:function(e){e.preventDefault(),d(!0)}}),Object(U.jsx)(E.a,{onClick:function(e){e.preventDefault(),r(n)}})]})})]}),Object(U.jsx)("style",{jsx:!0,children:"\n        .roleItem {\n          padding: 15px;\n          padding-left: 5px;\n        }\n        .roleItemCtrl {\n          display: none;\n        }\n        .roleItem:hover .roleItemCtrl {\n          display: block;\n        }\n        .roleItem:hover {\n          background-color: #e6f7ff;\n        }\n      "})]})},P=n(58),q=n(314),A=n(315),F=n(321),G=n(317),M=q.a.useForm,z={labelCol:{span:6},wrapperCol:{span:16}},D=function(e){var t=e.modalStatus,n=void 0!==t&&t,r=e.onConfirm,a=void 0===r?function(e){return Promise.resolve(!0)}:r,c=e.onCancel,l=void 0===c?function(){}:c,s=e.title,u=void 0===s?"":s,d=e.children,b=(e.showLoading,e.layout),j=void 0===b?{}:b,f=M(),m=Object(C.a)(f,1)[0],p=Object(i.useState)(!1),h=Object(C.a)(p,2),O=h[0],v=h[1];return Object(U.jsx)(G.a,{destroyOnClose:!0,visible:n,title:u,confirmLoading:O,onCancel:l,onOk:function(){m.validateFields().then((function(e){v(!0),a(e).then((function(){v(!1),m.resetFields()}))})).catch((function(e){console.error("Validate Failed:",e)}))},children:Object(U.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({form:m,preserve:!1},z),j),{},{children:d}))})},H=function(e){var t=e.onFinish,n=Object(g.a)(),o=n.t,r=n.i18n,a=Object(i.useState)(!1),c=Object(C.a)(a,2),l=(c[0],c[1],Object(i.useState)(!1)),s=Object(C.a)(l,2),u=s[0],d=s[1],b=Object(i.useState)([{roleCode:"manager",roleName:o("addRole.admin")},{roleCode:"normal",roleName:o("addRole.user")}]),j=Object(C.a)(b,2),f=j[0],m=(j[1],function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d(e)});return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(P.a,{onClick:function(){m(!0)},type:"primary",icon:Object(U.jsx)(F.a,{}),children:o("addRole.title")}),Object(U.jsxs)(D,{layout:"en-US"===r.language?{labelCol:{span:8},wrapperCol:{span:12}}:{},modalStatus:u,title:o("addRole.title"),onConfirm:function(e){var n=e.roleName,o=e.roleType;return _.apiService.addRole({roleName:n,roleType:o}).then((function(){return m(),t(!0),!0})).catch((function(){return!1}))},onCancel:function(){m(),t(!1)},children:[Object(U.jsx)(q.a.Item,{label:o("addRole.roleName"),name:"roleName",rules:[{required:!0,message:o("addRole.require")}],children:Object(U.jsx)(R.a,{maxLength:20})}),Object(U.jsx)(q.a.Item,{name:"roleType",label:o("addRole.selectRole"),initialValue:f[0].roleCode,required:!0,children:Object(U.jsx)(A.a,{children:f.map((function(e){return Object(U.jsx)(A.a.Option,{value:e.roleCode,children:e.roleName},e.roleCode)}))})})]})]})},Y=function(e){var t=e.visible,n=e.onOk,o=e.roleCode,r=Object(g.a)().t,a=Object(i.useState)(!1),c=Object(C.a)(a,2),l=c[0],s=c[1];return Object(U.jsx)(G.a,{destroyOnClose:!0,confirmLoading:l,visible:t,title:r("removeModal.title"),okText:r("removeModal.okText"),onCancel:function(){n(!1)},onOk:function(){s(!0),_.apiService.removeRole(o).then((function(e){s(!1),e&&n(!0)})).catch((function(e){s(!1),"e-1108"!==e.code?w.b.error(e.msg):G.a.info({okText:r("removeModal.confirmBtn"),content:r("removeModal.confirmContent"),onOk:function(){n(!1)}})}))},children:Object(U.jsx)("span",{children:r("removeModal.content")})})},Q=n(118),J=n.n(Q),K=function(e){var t=e.onSelect,n=Object(g.a)().t,r=Object(i.useState)([]),a=Object(C.a)(r,2),c=a[0],l=a[1],s=Object(i.useState)(""),u=Object(C.a)(s,2),d=u[0],b=u[1],j=Object(i.useState)(1),f=Object(C.a)(j,2),m=f[0],p=f[1],h=Object(i.useState)({visible:!1,roleCode:""}),O=Object(C.a)(h,2),v=O[0],x=O[1];Object(i.useEffect)((function(){_.apiService.getEntireRoles().then((function(e){var n=e.filter((function(e){return"admin"!==e.roleCode}));if(l(n),n.length){var o=n[0];n.length>1&&m>1&&(o=n[n.length-1]),b(o.roleCode),t(o.roleCode)}}))}),[m]);var S=function(){p((function(e){return e+1}))};return Object(U.jsxs)("div",{className:J.a.roleListWrap,children:[Object(U.jsxs)(N.a,{justify:"space-between",align:"middle",className:J.a.roleListTop,children:[Object(U.jsx)(k.a,{className:J.a.roleListTitle,children:n("roleList.title")}),Object(U.jsx)(k.a,{children:Object(U.jsx)(H,{onFinish:function(e){e&&S()}})})]}),Object(U.jsx)("div",{children:c.map((function(e){var o=d===e.roleCode,r=e.roleName;return e.roleCode!==I&&e.roleCode!==W||(r=n("roleList.".concat(e.roleCode))),Object(U.jsx)("div",{className:"".concat(o?"selected":""),onClick:function(){d!==e.roleCode&&(b(e.roleCode),t(e.roleCode))},children:Object(U.jsx)(B,{roleCode:e.roleCode,roleName:r,onFinish:function(e){e&&S()},onRemove:function(e){x({visible:!0,roleCode:e})}})},"".concat(e.roleCode))}))}),Object(U.jsx)(Y,Object(o.a)(Object(o.a)({},v),{},{onOk:function(e){x({visible:!1,roleCode:""}),e&&S()}})),Object(U.jsx)("style",{jsx:!0,children:"\n        .selected {\n          background-color: #f0f0f0;\n        }\n      "})]})},V=n(76),X=n(313),Z=n(318),$=n(176),ee=function e(t){var n=[];return t.forEach((function(t){n.push(t),t.children&&n.push.apply(n,Object($.a)(e(t.children)))})),n},te=n(64),ne=n.n(te),oe=function(e){var t=e.roleCode,n=e.disabled,o=void 0!==n&&n,r=Object(g.a)().t,a=Object(i.useState)(!1),c=Object(C.a)(a,2),l=c[0],s=c[1],u=Object(i.useState)([]),d=Object(C.a)(u,2),b=d[0],j=d[1],f=Object(i.useState)([]),m=Object(C.a)(f,2),p=m[0],h=m[1],O=Object(i.useState)([]),v=Object(C.a)(O,2),x=v[0],S=v[1],y=Object(i.useState)([]),R=Object(C.a)(y,2),T=R[0],L=R[1],E=Object(i.useState)([]),I=Object(C.a)(E,2),W=I[0],B=I[1];Object(i.useEffect)((function(){if(t){var e=_.apiService.getRolePermissionTemplate(t.split("-")[0]),n=_.apiService.getRolePermissionDetail(t),o=_.apiService.getRolePermissionTemplate("admin");Promise.all([o,n,e]).then((function(e){var t=Object(C.a)(e,3),n=t[0],o=t[1],r=t[2];h(n),S(ee(n));var a=o.map((function(e){return e.permissionCode}));j(a);var c=ee(r).map((function(e){return e.permissionCode}));L(c)}))}}),[t]),Object(i.useEffect)((function(){var e=function(e,t){var n=new Set(t);return e.map((function(e){var t=!0,o=!0,r=e.children.map((function(e){var r=n.has(e.permissionCode);return!r&&e.authorizable&&(t=!1),r&&(o=!1),Object.assign({},e,{checked:r})}));return Object.assign({},e,{checked:n.has(e.permissionCode),indeterminate:!t&&!o,children:r})}))}(p,b);B(e)}),[p,b]);var q=function(e,t){var n=function(e,t,n,o){var r=function(e,t){var n={};return e.forEach((function(e){n[e[t]]=e})),n}(o,"permissionCode"),a=new Set(n);o.forEach((function(e){var t=e.parentCode;r[t]&&(r[t].childrenCodes?r[t].childrenCodes.push(e.permissionCode):r[t].childrenCodes=[e.permissionCode])}));var c=r[e];if(t){if("menu"===c.permissionType&&(a.add(e),r[e].childrenCodes.forEach((function(e){r[e].authorizable&&a.add(e)}))),"api"===c.permissionType||"button"===c.permissionType){var i=r[c.parentCode];i.checked=!0,a.add(i.permissionCode),a.add(e),c.dependencies.forEach((function(e){a.add(e)}))}}else if("menu"===c.permissionType&&(a.delete(e),r[e].childrenCodes.forEach((function(e){a.delete(e)}))),"api"===c.permissionType||"button"===c.permissionType){var l;a.delete(e);var s=r[c.parentCode],u=null===(l=r[s.permissionCode])||void 0===l?void 0:l.childrenCodes;if(u){var d=!0;u.forEach((function(t){r[t].dependencies.includes(e)&&a.delete(t),a.has(t)&&(d=!1)})),d&&a.delete(s.permissionCode)}}return Array.from(a)}(e,t,b,x);j(n)};return Object(U.jsx)(U.Fragment,{children:t?Object(U.jsxs)(X.a,{spinning:l,children:[Object(U.jsx)("div",{className:ne.a.tableWrap,children:W.map((function(e,n){var r=!e.authorizable;return o&&(r=!0),Object(U.jsxs)(N.a,{align:"middle",className:ne.a.rowWrap,children:[Object(U.jsx)(k.a,{span:4,children:Object(U.jsx)(Z.a,{disabled:r,className:ne.a.checkbox,indeterminate:e.indeterminate,checked:e.checked,onChange:function(t){var n=t.target.checked;e.indeterminate&&(n=!0),q(e.permissionCode,n)},children:e.permissionName})}),Object(U.jsx)(k.a,{span:1,children:Object(U.jsx)("div",{className:ne.a.border})}),Object(U.jsx)(k.a,{span:19,children:Object(U.jsx)(N.a,{justify:"start",children:e.children.map((function(e,r){var a=!e.authorizable;return o&&(a=!0),Object(U.jsx)(k.a,{children:Object(U.jsx)(Z.a,{disabled:a,className:ne.a.checkbox,checked:e.checked,onChange:function(t){var n=t.target.checked;q(e.permissionCode,n)},children:e.permissionName})},"".concat(t,"-").concat(n,"-").concat(r))}))})})]},"".concat(t,"-").concat(n))}))}),Object(U.jsxs)(N.a,{justify:"end",className:ne.a.buttonGroupWrap,gutter:16,children:[Object(U.jsx)(k.a,{pull:1,children:Object(U.jsx)(P.a,{disabled:o,onClick:function(){j(T)},children:r("permissionTable.reset")})}),Object(U.jsx)(k.a,{pull:1,children:Object(U.jsx)(P.a,{disabled:o,type:"primary",onClick:function(){s(!0),_.apiService.grantPermissionByRole({roleCode:t,permissionCodes:b}).then((function(){s(!1),w.b.info(r("permissionTable.success"))})).catch((function(){s(!1)}))},children:r("permissionTable.save")})})]})]}):Object(U.jsx)(V.a,{})})},re=function(){Object(g.a)().t;var e=Object(i.useState)(""),t=Object(C.a)(e,2),n=t[0],o=t[1],r=Object(i.useState)(""),a=Object(C.a)(r,2),c=a[0],l=a[1];return Object(i.useEffect)((function(){var e=localStorage.getItem("_ROLE_TYPE");l(e)}),[]),Object(U.jsxs)(N.a,{className:y.a.wrap,wrap:!1,children:[Object(U.jsx)(k.a,{flex:"250px",children:Object(U.jsx)(K,{onSelect:function(e){o(e)}})}),Object(U.jsx)(k.a,{flex:"5px",children:Object(U.jsx)("div",{style:{flex:1,width:5,height:"100%",backgroundColor:"#f0f2f5"}})}),Object(U.jsx)(k.a,{flex:"auto",children:Object(U.jsx)(oe,{roleCode:n,disabled:"admin"!==c})})]})},ae=function(){return Object(U.jsx)(re,{})},ce=n(165);var ie,le,se,ue=function(e){Object(ce.a)();var t="zh-CN"===Object(d.d)().language?x.a:O.a;return Object(U.jsx)(p.a,{locale:t,children:Object(U.jsx)(ae,{})})};function de(e){var t=e.base,n=e.container;s.a.render(Object(U.jsx)(u.a,{basename:window.__POWERED_BY_QIANKUN__?t:"/",children:Object(U.jsx)(ue,{})}),n?n.querySelector("#root"):document.querySelector("#root"))}function be(){return je.apply(this,arguments)}function je(){return(je=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("\u5b50\u5e94\u7528\u542f\u52a8");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e){return me.apply(this,arguments)}function me(){return(me=Object(c.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("\u6302\u8f7d\u5b50\u5e94\u7528",t),Object(d.d)().changeLanguage(t.lang),se=t.mainHistory,de(t),t.onGlobalStateChange((function(e,t){console.log("\u8d44\u4ea7\u5fae\u5e94\u7528",e,t),le=e}),!0),ie=function(e){t.setGlobalState(Object(o.a)(Object(o.a)({},le),e))};case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return he.apply(this,arguments)}function he(){return(he=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.container,s.a.unmountComponentAtNode(n?n.querySelector("#root"):document.querySelector("#root"));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}window.__POWERED_BY_QIANKUN__||de({})},64:function(e,t,n){e.exports={rowWrap:"rowWrap_20_XW",rightBorder:"rightBorder_3nU41",checkbox:"checkbox_2Ym0N",buttonGroupWrap:"buttonGroupWrap_2zfth",tableWrap:"tableWrap_3fEL4",border:"border_3seI9"}}},[[309,1,2]]])}));